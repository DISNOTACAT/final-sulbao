<!DOCTYPE html>
<html lang="en" layout:decorate="~{common/layouts/userDefault}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>술포스트</title>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        .container {
            max-width: 1300px;
            padding: 20px;
            margin: 30px auto 0;
        }

        .hero {
            background: #f8f9fa;
            padding: 50px 0;
        }

        .hero h1 {
            font-size: 2.5rem;
        }

        .hero p {
            font-size: 1.25rem;
            color: #6c757d;
            margin-top: 30px;
        }

        .post-count {
            font-size: 1.125rem;
            margin-bottom: 20px;
        }

        .post-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .post-item {
            width: calc(33.333% - 20px);
            box-sizing: border-box;
            text-align: center;
        }

        .post-item img {
            width: 100%;
            height: auto;
            max-width: 400px;
            max-height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .post-item img:hover {
            transform: scale(1.03);
        }

        .post-item h3 {
            font-size: 1rem;
            margin-top: 10px;
        }

        .title {
            font-weight: bold;
            font-size: 1.4rem;
        }

        .author {
            font-size: 1rem;
            color: #333;
            margin-top: 5px;
        }

        .post-meta {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .post-item {
                width: calc(50% - 20px);
            }
        }

        @media (max-width: 480px) {
            .post-item {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="hero hero-inner">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 mx-auto text-center">
                    <div class="intro-wrap">
                        <h1 class="mb-0">술 포스트</h1>
                        <p class="text-white">
                            술 포스트는 술에 대한 모든 것을 다룹니다.<br>
                            술의 역사, 문화, 맛, 그리고 다양한 이야기를 만나보세요.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="post-count">전체 13,070</div>
        <div class="post-grid" id="postGrid">
            <div class="post-item" th:each="postDto : ${postDtoList}">
                <a th:href="@{|zzanposts/${postDto.id}|}">
                    <!--                    <img alt="Post Thumbnail" th:src="@{|${postDto.postImageDtoList.get(0).fileName}|}">-->
                    <img alt="Post Thumbnail"
                         src="https://img.hankyung.com/photo/202112/AKR20211206035900003_01_i_P4.jpg">
                    <div class="title" th:text="${postDto.title}"></div>
                </a>
                <div class="author" th:text="${postDto.userDto.profileName}"></div>
                <div class="post-meta" th:utext="'추천 수 ' + ${postDto.like} + '&nbsp;&nbsp; 조회 ' + ${postDto.hit}"></div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            let page = 1;
            const postGrid = $('#postGrid');
            const totalPosts = 13070;

            $(window).on('scroll', _.debounce(function () {
                if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
                    loadMorePosts(page);
                    page++;
                }
            }, 200));

            function loadMorePosts(page) {
                $.ajax({
                    url: '/zzanposts/more',
                    type: 'GET',
                    data: {
                        page: page
                    },
                    success: function (postDtoList) {
                        if (postDtoList.length > 0) {
                            postDtoList.forEach(function (postDto) {
                                const postHtml = `
                            <div class="post-item">
                                <a href="/zzanposts/${postDto.id}">
<!--                                    <img alt="Post Thumbnail" src="${postDto.postImageDtoList[0].fileName}">-->
                                    <img alt="Post Thumbnail" src="https://img.hankyung.com/photo/202112/AKR20211206035900003_01_i_P4.jpg">
                                    <div class="title">${postDto.title}</div>
                                </a>
                                <div class="author">${postDto.userDto.profileName}</div>
                                <div class="post-meta">추천 수 ${postDto.like}&nbsp;&nbsp;조회 ${postDto.hit}</div>
                            </div>`;
                                postGrid.append(postHtml);
                            });
                        } else {
                            $(window).off("scroll");
                        }
                    },
                    error: function () {
                        console.log("Error loading more posts");
                    }
                });
            }
        });
    </script>
</div>
</body>
</html>